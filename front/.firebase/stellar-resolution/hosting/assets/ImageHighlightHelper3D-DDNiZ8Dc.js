const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GraphicsView3D-1X_tkPWf.js","assets/index-BCRx-hwS.js","assets/index-BR8bGno3.css","assets/GraphicsProcessor-C6PAYHLb.js","assets/renderingInfoUtils-BAhgEqIm.js","assets/ExtentSet-K5YofjIQ.js","assets/rendererConversion-rehhbVqC.js","assets/optimizedFeatureQueryEngineAdapter-J27F0OEg.js","assets/PooledRBush-BHawq76M.js","assets/quickselect-QQC62dOK.js","assets/popupUtils-CwFAf9xs.js","assets/Graphics3DObjectStates-DZSXvLqg.js","assets/highlightUtils-BYf6_sO_.js"])))=>i.map(i=>d[i]);
import{a8 as u,V as d,L as c,c as w,jv as y,J as _,fj as m,fk as f,H as v,G as g,_ as V,F as H,Z as $,a3 as G,gM as C,fJ as L,r as o,m as l,b as M}from"./index-BCRx-hwS.js";function b(i){if(!i)return[];let e=u(i)?[i]:d.isCollection(i)?i.toArray():Array.isArray(i)?i:[];return e=e==null?void 0:e.filter(c),((e==null?void 0:e.length)??0)===0?[]:e}let h=class extends w{get updating(){var i;return((i=this.graphicsView)==null?void 0:i.updating)??!1}constructor(i){super(i),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new y,this.graphicsView=null,this.suspended=!1;const e=new _([255,255,255,1/255]);this._symbols=new Map([["point",new m({size:"2px",style:"square",color:e})],["polyline",new f({width:"2px",color:e})],["polygon",new v({outline:null,color:e})]])}highlight(i,e){const s=b(i);if(s.length===0)return g();let a,t=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(s),this._ensureGraphicsView3D()]).then(([n,r])=>{!t&&r&&(a=this._addHighlightGraphics(r,n,e))})),g(()=>{t=!0,a==null||a.remove()})}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(i,e,s){for(const t of e)this._highlightCounts.set(t,(this._highlightCounts.get(t)??0)+1);this.graphics.addMany(e);const a=i.highlight(e,s);return g(()=>{this._removeHighlightGraphics(e),a.remove()})}_removeHighlightGraphics(i){this.graphics.removeMany(i.filter(e=>{const s=Math.max(0,(this._highlightCounts.get(e)??0)-1);return s===0?(this._highlightCounts.delete(e),!0):(this._highlightCounts.set(e,s),!1)}))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=V(()=>import("./GraphicsView3D-1X_tkPWf.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])));const{default:i}=await this._graphicsViewLoader;if(this.destroyed)return null;const e=new i({view:this.view,layer:this.layer,getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set("graphicsView",e),this.addHandles([H(this.graphicsView),$(()=>this.suspended,s=>{e.suspended=s},G)]),e}async _createHighlightGraphics(i){const e=i.map(({geometry:t})=>t==null?void 0:t.spatialReference).filter(c).reduce((t,n)=>{var r;return t.length!==0&&((r=t.at(-1))!=null&&r.equals(n))||t.push(n),t},[]),s=this.view.spatialReference,a=e.map(t=>({source:t,dest:s}));try{await C(a)}catch{return[]}return i.map(t=>{const{geometry:n}=t;try{const r=n?L(n,s):null,p=t.cloneShallow();return p.geometry=r,p.symbol=this._symbols.get(r==null?void 0:r.type),p}catch{return t}})}};o([l()],h.prototype,"graphics",void 0),o([l()],h.prototype,"graphicsView",void 0),o([l()],h.prototype,"view",void 0),o([l()],h.prototype,"layer",void 0),o([l()],h.prototype,"updatingHandles",void 0),o([l()],h.prototype,"suspended",void 0),o([l()],h.prototype,"updating",null),h=o([M("esri.views.3d.layers.support.ImageHighlightHelper3D")],h);export{h as w};
