import{r,m as s,b as $,c as xt,V as st,h as Gt,cs as at,dp as lt,iW as it,at as $t,au as Ft,v4 as Ht,rA as zt,rS as N,fo as T,s1 as Lt,ek as Dt,sW as Nt,xA as Zt,rL as jt,bO as Yt,xB as Bt,xC as Wt,p$ as Qt,al as qt,an as Jt,kA as Ut,h_ as Kt,di as Xt,Z as te,xD as ct,a3 as ee,$ as ie,u as K,I as oe,G as Y,qs as ne,aS as G,e3 as F,s7 as dt,xE as re,xF as se,fb as ae,mY as le,m_ as pt,av as tt,xG as Q,bd as ce,fS as ut,mS as ht,aw as yt,xH as gt}from"./index-BCRx-hwS.js";import{r as I,V as de,R as pe,E as ue,e as he,H as ye}from"./SketchTooltipInfo-ClKEIWze.js";import{a as ge}from"./dehydratedFeatureComparison-CjFdXHe0.js";import{Z as me,c as fe,k as mt,a as ve,b as ft,U as we,T as Oe,j as vt,R as _e}from"./drawSurfaces-DH8cxNSF.js";import{h as Z,k as ke,R as xe,y as bt,F as Vt,Q as $e,w as Ue}from"./TooltipInfoWithCoordinates-BgthvA3y.js";import{n as be}from"./InteractiveToolBase-Cty8kcDX.js";import{t as Ve,c as Te,e as Ie,d as Re}from"./EditGeometryOperations-DzaQFUYT.js";var m;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(m||(m={}));var x;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(x||(x={}));const q={[x.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[x.UndoInvalidError]:"There are no items to Undo",[x.RedoInvalidError]:"There are no items to Redo",[x.ApplyInvalidError]:"Cannot apply an item that is already applied"};let H=class extends Error{constructor(){super(q[x.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},et=class extends Error{constructor(){super(q[x.UndoInvalidError]),this.type="undo-redo-undo-error"}},wt=class extends Error{constructor(){super(q[x.RedoInvalidError]),this.type="undo-redo-redo-error"}},Ee=class extends Error{constructor(){super(q[x.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var b;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(b||(b={}));let B=class extends xt{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=m.NeverApplied}get canUndo(){return this.status===m.Applied}get canRedo(){return this.status===m.Undone}async executeUndoRedoOperation(e){switch(e){case b.Apply:if(this.status!==m.NeverApplied)throw new Ee;return await this.apply(),void(this.status=m.Applied);case b.Undo:if(this.status!==m.Applied)throw new et;return await this.undo(),void(this.status=m.Undone);case b.Redo:if(this.status!==m.Undone)throw new et;return await this.redo(),void(this.status=m.Applied)}}};r([s()],B.prototype,"name",void 0),r([s()],B.prototype,"tag",void 0),B=r([$("esri.undoredo.UndoableOperation")],B);let _=class extends xt{constructor(){super(...arguments),this._stack=new st,this._stackPosition=-1,this._updatingHandles=new Gt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new et;if(this.updating)throw new H;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(b.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new wt;if(this.updating)throw new H;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new wt;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(b.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new H;await this._updatingHandles.addPromise((async()=>{t.status===m.NeverApplied&&await t.executeUndoRedoOperation(b.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new H;await this._updatingHandles.addPromise((async()=>{t.status===m.NeverApplied&&await t.executeUndoRedoOperation(b.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await at(()=>!this.updating);const i=new st;for(let o=0;o<this._stack.length;o++){const n=this._stack.getItemAt(o);n&&(n.tag===t?(n.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(n))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new H;await at(()=>!this.updating),this._drainStack()}};r([s()],_.prototype,"_stack",void 0),r([s()],_.prototype,"_stackPosition",void 0),r([s()],_.prototype,"updating",null),r([s({readOnly:!0})],_.prototype,"canUndo",null),r([s({readOnly:!0})],_.prototype,"hasUndo",null),r([s({readOnly:!0})],_.prototype,"canRedo",null),r([s({readOnly:!0})],_.prototype,"hasRedo",null),_=r([$("esri.UndoRedo")],_);let Se=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function P(t,e,i){if(t==null)return"noTool";switch(t){case"point":return Me();case"multipoint":return"multipoint";case"polyline":return Pe(e,i);case"polygon":return Ae(e,i);case"rectangle":case"circle":return Ce(e,i);default:return}}function Me(t){return"point"}function Pe(t,e){const i=t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0;return e==="freehand"?i<2?"freehandStart":"freehandEnd":i<2?"polylineZeroVertices":"polylineOneVertex"}function Ae(t,e){const i=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;if(i<3)switch(e){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(i<4)return e==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function Ce(t,e){if((t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0)<3)switch(e){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(e){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}function Ge(t,e){const i=t==null?void 0:t.geometry;if(!t||(i==null?void 0:i.type)!=="mesh"||!e)return;const{renderCoordsHelper:o,elevationProvider:n}=e,{camera:l}=e.state,{extent:a}=i,{center:c,spatialReference:u}=a,p=lt(u),y=it(u),g=lt(o.spatialReference),w=a.width*p,f=a.height*y,h=(a.zmax??0)*y,R=h-(a.zmin??0)*y,j=Math.max(w,f,R)/g,{x:E,y:O}=c,V=c.z??0;$t(W,E,O,V),o.toRenderCoords(W,u,W);const C=j/l.computeScreenPixelSizeAt(W);if(C>l.width*He)return"meshTooClose";if(C<Fe)return"meshTooFar";const At=Ht(t),{absoluteZ:Ct}=zt(E,O,h,u,e,At);return Ct<(n.getElevation(E,O,V,u,"ground")??0)*y+R*ze?"meshUnderground":"mesh"}const Fe=20,He=1,ze=.1,W=Ft();let k=class extends I{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=N}get allFields(){return[]}};r([s()],k.prototype,"type",void 0),r([s()],k.prototype,"radius",void 0),r([s()],k.prototype,"xSize",void 0),r([s()],k.prototype,"ySize",void 0),r([s()],k.prototype,"area",void 0),r([s()],k.prototype,"helpMessage",void 0),r([s()],k.prototype,"allFields",null),k=r([$("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],k);let z=class extends Z(I){constructor(e){super(e),this.type="draw-mesh",this.orientation=ke({lockable:!1}),this.scale=xe({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};r([s()],z.prototype,"helpMessage",void 0),r([s()],z.prototype,"allFields",null),z=r([$("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],z);let L=class extends Z(I){constructor(e){super(e),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};r([s()],L.prototype,"helpMessage",void 0),r([s()],L.prototype,"allFields",null),L=r([$("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],L);let D=class extends Z(I){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};r([s()],D.prototype,"helpMessage",void 0),r([s()],D.prototype,"allFields",null),D=r([$("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],D);let S=class extends Z(I){constructor(e){super(e),this.type="draw-polygon",this.direction=bt(),this.distance=Vt(),this.area=$e(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};r([s()],S.prototype,"xyMode",void 0),r([s()],S.prototype,"helpMessage",void 0),r([s()],S.prototype,"allFields",null),S=r([$("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],S);let M=class extends Z(I){constructor(t){super(t),this.type="draw-polyline",this.direction=bt(),this.distance=Vt(),this.totalLength=Ue(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};r([s()],M.prototype,"helpMessage",void 0),r([s()],M.prototype,"xyMode",void 0),r([s()],M.prototype,"allFields",null),M=r([$("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],M);let U=class extends I{constructor(t){super(t),this.type="draw-rectangle",this.xSize=T,this.ySize=T,this.area=N}get allFields(){return[]}};r([s()],U.prototype,"type",void 0),r([s()],U.prototype,"xSize",void 0),r([s()],U.prototype,"ySize",void 0),r([s()],U.prototype,"area",void 0),r([s()],U.prototype,"helpMessage",void 0),r([s()],U.prototype,"allFields",null),U=r([$("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],U);function Le(t,e){return{point:new D({sketchOptions:e,viewType:t}),multipoint:new L({sketchOptions:e,viewType:t}),polyline:new M({sketchOptions:e,viewType:t}),polygon:new S({sketchOptions:e,viewType:t}),mesh:new z({sketchOptions:e,viewType:t}),rectangle:new U({sketchOptions:e}),circle:new k({sketchOptions:e})}}function Ot(t){const{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:n}=t,l=c=>{const u=J(t).mode,p=n[c].elevation;u==="relative-to-ground"||u==="relative-to-scene"||u==="on-the-ground"?p.lock(rt(t)):p.unlock()},a=c=>{if(e){const u=n[c].direction;u.committed=e.angle,u.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":l(i),a(i);break;case"point":case"mesh":l(i)}}function De(t,e){const{drawOperation:i,view:o}=e,n=ot(e),l=J(e);if(o.type==="2d"||!t||l.mode!=="absolute-height"||(i==null?void 0:i.numCommittedVertices)!==1||!n||n.type!=="draw-polyline"&&n.type!=="draw-polygon"||n.elevation.locked)return;const[a,c,u]=t,p=ei(a,c,u,l,e);p!=null&&n.elevation.lock(p)}function _t(t){var e;(e=ot(t))==null||e.allFields.forEach(i=>{i.unlockOnVertexPlacement&&i.unlock()})}function ot({geometryType:t,graphic:e,tooltipInfos:i}){var o;return((o=e==null?void 0:e.geometry)==null?void 0:o.type)!==Ne[t]?t==="circle"||t==="rectangle"?i[t]:null:i[t]}const Ne={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function Ze(t,e){switch(t==null?void 0:t.type){case"draw-point":je(t,e);break;case"draw-multipoint":Ye(t,e);break;case"draw-polyline":We(t,e);break;case"draw-polygon":Qe(t,e);break;case"draw-rectangle":Je(t,e);break;case"draw-circle":Ke(t,e);break;case"draw-mesh":Be(t,e)}}function je(t,e){var o;const i=(o=e.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="point"&&(nt(t,i,e),t.helpMessage=P("point",i,e.drawOperation.drawingMode))}function Ye(t,e){var o;const i=(o=e.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="multipoint"&&(nt(t,i,e),t.helpMessage=P("multipoint",i,e.drawOperation.drawingMode))}function Be(t,e){const{graphic:i,view:o}=e,n=i==null?void 0:i.geometry;o.type!=="3d"||n&&n.type!=="mesh"||(nt(t,n==null?void 0:n.origin,e),n&&de(t,n),t.helpMessage=Ge(i,o))}function nt(t,e,i){const{drawOperation:o,view:n,sketchOptions:l}=i,{cursorVertex:a}=o;t.sketchOptions=l,t.viewType=n.type;const c=(e==null?void 0:e.type)==="multipoint"?e.getPoint(e.points.length-1):e;if(t.setLocationFromPoint(c,A(i)),It(t.elevation,i),!a)return void(o.constraints=void 0);const u=a;o.constraints={context:Mt(u,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function We(t,e){const{createOperationGeometry:i,drawOperation:o,automaticLengthMeasurementUtils:n}=e,l=i!=null?i.full:null;l&&l.type!=="polyline"||(Tt(t,e),t.totalLength.actual=o.lastVertex?(l?n.autoLength2D(l):null)??T:null,t.helpMessage=P("polyline",l,e.drawOperation.drawingMode))}function Qe(t,e){const{createOperationGeometry:i,drawOperation:o}=e,n=i!=null?i.full:null;n&&n.type!=="polygon"||(Tt(t,e),t.area.actual=o.lastVertex?(n?e.automaticAreaMeasurementUtils.autoArea2D(n):null)??N:null,t.helpMessage=P("polygon",n,e.drawOperation.drawingMode))}const kt=Yt(qt);function Tt(t,e){const{drawOperation:i,sketchOptions:o,view:n,automaticLengthMeasurementUtils:l}=e,{cursorVertex:a,lastVertex:c,secondToLastVertex:u}=i,p=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=n.type;const y=c&&a?l.autoDistanceBetweenPoints2D(kt(c),kt(a))??T:null;if(t.distance.actual=y,t.distance.readOnly=c==null,t.direction.actual=null,t.direction.readOnly=!0,c&&a&&(p==="absolute"||u)){const f=Bt(u,c,a,p);t.direction.actual=f??Wt,t.direction.readOnly=!1}t.setLocationFromPoint(a,A(e)),It(t.elevation,e);const g=qe(c,e);t.xyMode=g,t.direction.visible=g==="direction-distance",t.distance.visible=g==="direction-distance",t.effectiveX.visible=g==="coordinates",t.effectiveY.visible=g==="coordinates";const w=a??c;i.constraints=w?{context:Mt(w,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function qe(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function Je(t,e){var i;t.sketchOptions=e.sketchOptions,t.xSize=Et(e),t.ySize=St(e),t.area=Rt(e),t.helpMessage=P("rectangle",(i=e.graphic)==null?void 0:i.geometry,e.drawOperation.drawingMode)}function Ke(t,e){var n;const{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?Xe(e):null,t.xSize=i?null:Et(e),t.ySize=i?null:St(e),t.area=Rt(e),t.helpMessage=P("circle",(n=e.graphic)==null?void 0:n.geometry,e.drawOperation.drawingMode)}function It(t,e){const{drawOperation:i}=e,o=(i==null?void 0:i.cursorVertex)??(i==null?void 0:i.lastVertex);t.actual=Qt(o)??rt(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function Rt(t){var i;const e=(i=t.createOperationGeometry)==null?void 0:i.full;return(e==null?void 0:e.type)!=="polygon"?N:t.automaticAreaMeasurementUtils.autoArea2D(e)??N}function Et({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){var o;const i=(o=t==null?void 0:t.rectangle)==null?void 0:o.midpoints;return(i!=null?e.autoDistanceBetweenPoints2D(i.left,i.right):null)??T}function St({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){var o;const i=(o=t==null?void 0:t.rectangle)==null?void 0:o.midpoints;return(i!=null?e.autoDistanceBetweenPoints2D(i.top,i.bottom):null)??T}function Xe({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){var i;return(((i=t==null?void 0:t.circle)==null?void 0:i.center)!=null&&t.circle.edge!=null?e.autoDistanceBetweenPoints2D(t.circle.center,t.circle.edge):null)??T}function ti(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const o=i[e].elevation.committed;return o?Lt(o,"meters")/it(A(t)):void 0}default:return}}function ei(t,e,i,o,n){const{view:l,drawOperation:a}=n;if(l.type!=="3d"||!a)return;i??(i=0);const c=A(n),u=J(n),p=Nt(l,t,e,i,c,u,o);return Zt(p,c)??rt(n)}function J(t){return t.drawOperation.elevationInfo??Dt}function A(t){return t.drawOperation.coordinateHelper.spatialReference}function rt(t){const e=it(A(t));return jt(t.defaultZ*e,"meters")}function Mt(t,e){return me(t,e.view,A(e),J(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}let d=class extends Jt.EventedMixin(be){constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Ut}initialize(){const{view:e}=this;this.internalGraphicsLayer=new Kt({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const i=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Le(e.type,this.sketchOptions);const o=pe(()=>({view:e,options:this.sketchOptions.tooltips}));this.tooltip=o,Ot(this._tooltipsContext),this._coordinateFormatterLoadTask=Xt(()=>ue()),this.addHandles([i.on("vertex-add",n=>this.onVertexAdd(n)),i.on("vertex-remove",n=>this.onVertexRemove(n)),i.on("vertex-update",n=>this.onVertexUpdate(n)),i.on("cursor-update",n=>this.onCursorUpdate(n)),i.on("cursor-remove",()=>this._updateGraphic()),i.on("complete",n=>this.onComplete(n)),this._coordinateFormatterLoadTask,o.on("paste",n=>he(n,this.activeTooltipInfo)),te(()=>this.cursor,n=>{i.cursor=n},ee),ct(()=>{const{activeTooltipInfo:n,sketchOptions:l}=this;Ze(n,this._tooltipsContext),o.info=l.tooltips.effectiveEnabled?n:null}),ct(()=>{i.constraintZ=ti(this._tooltipsContext)},ie)]),this.finishToolCreation()}destroy(){this.drawOperation=K(this.drawOperation),this.tooltip=K(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=K(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){const{defaultZ:e,directionOptions:i,drawOperation:o,forceUniformSize:n,geometryType:l,graphic:a,sketchOptions:c,tooltipInfos:u,view:p,automaticAreaMeasurementUtils:y,automaticLengthMeasurementUtils:g}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:e,directionOptions:i,drawOperation:o,forceUniformSize:n,geometryType:l,graphic:a,sketchOptions:c,tooltipInfos:u,view:p,automaticAreaMeasurementUtils:y,automaticLengthMeasurementUtils:g}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),this._graphic!=null&&(this._graphic.symbol=e)}set mode(e){const i=this.drawOperation;i&&(i.drawingMode=e),this._set("mode",e)}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}get undoRedo(){const{view:{type:e,map:i}}=this;return e==="2d"&&i&&"undoRedo"in i&&i.undoRedo instanceof _?i.undoRedo:null}set undoRedo(e){this._override("undoRedo",e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||ye(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&Ot(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(v.outline),this.removeHandles(v.regularVertices),this.removeHandles(v.activeVertex),this.removeHandles(v.activeEdge),this.removeHandles(X)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(e),this._graphic;const i=new oe({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=i,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(i),this.addHandles(this.initializeGraphic(i)),this.notifyChange("graphic"),this.addHandles(Y(()=>{this.internalGraphicsLayer.remove(i),this._graphic===i&&(this._graphic=null)}),X),i}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){var j,E;if(this.drawOperation==null)return;const{coordinateHelper:i,view:o,visualizationCursorVertex:n,lastVertex:l,committedVertices:a,geometryIncludingUncommittedVertices:c,numCommittedVertices:u}=this.drawOperation;if(!(u>0||n!=null))return;const p=e.operationComplete?a:c,y=p.length,g=n!=null?i.pointToArray(n):null,w=this._drawSpatialReference,f=o.type==="3d"&&o.viewingMode==="global",h=new Se;h.committedVertices=a,h.cursorVertex=g;const{geometryType:R}=this;switch(R){case"point":case"mesh":h.full=i.arrayToPoint(p[0]);break;case"multipoint":h.full=y>0?_e(p,w):null;break;case"polyline":case"polygon":y>0&&(h.full=R==="polygon"?Oe([p],w,f,!0):vt([p],w,f),h.cursorEdge=g!=null&&l&&!ge(n,l)?vt([[g,i.pointToArray(l)]],w,f):null,h.outline=y>1?h.full:null);break;case"circle":case"rectangle":{if(h.committedVertices=h.cursorVertex=null,!y)break;const O=fe(o,p[0]),V=p[0],C=O.makeMapPoint(V[0]+ii*o.resolution,V[1]);R==="circle"?y===1&&e.operationComplete?h.circle=mt([V,C],O,!0):y===2&&(this.forceUniformSize?h.circle=mt(p,O,this.centered):h.rectangle=ve(p,O,this.centered)):y===1&&e.operationComplete?h.rectangle=ft([V,C],O,!0):y===2&&(h.rectangle=this.forceUniformSize?ft(p,O,this.centered):we(p,O,this.centered)),h.full=h.circle!=null?h.circle.geometry:(j=h.rectangle)==null?void 0:j.geometry,h.outline=((E=h.full)==null?void 0:E.type)==="polygon"?h.full:null;break}default:return null}return h}initializeGraphic(e){return Y()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let i=null;if(this.drawOperation.isCompleted){const o=this._getCreateOperationGeometry({operationComplete:!0});o!=null&&(i=this._createOrUpdateGraphic(o.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:i,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){const{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return Y()}onCursorEdgeChanged(e){return Y()}onVertexAdd(e){var i;_t(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||De((i=e.vertices.at(0))==null?void 0:i.coordinates,this._tooltipsContext),this.emit("vertex-add",e)}onVertexRemove(e){_t(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e!=null?(e.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),v.activeEdge):this.removeHandles(v.activeEdge),e.outline!=null?this.addHandles(this.onOutlineChanged(e.outline),v.outline):this.removeHandles(v.outline),e.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(e.committedVertices),v.regularVertices):this.removeHandles(v.regularVertices),e.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(e.cursorVertex),v.activeVertex):this.removeHandles(v.activeVertex),e.full!=null?this._createOrUpdateGraphic(e.full):this.removeHandles(X)):this._destroyAllVisualizations()}get activeTooltipInfo(){var e;return(e=this._coordinateFormatterLoadTask)!=null&&e.finished?ot(this._tooltipsContext):null}};r([s()],d.prototype,"_coordinateFormatterLoadTask",void 0),r([s()],d.prototype,"_createOperationGeometry",void 0),r([s()],d.prototype,"_tooltipsContext",null),r([s({value:!0})],d.prototype,"centered",null),r([s()],d.prototype,"cursor",null),r([s({nonNullable:!0})],d.prototype,"defaultZ",void 0),r([s({constructOnly:!0})],d.prototype,"directionOptions",void 0),r([s()],d.prototype,"drawOperation",void 0),r([s()],d.prototype,"elevationLockOnVertexAddDisabled",void 0),r([s({value:!0})],d.prototype,"enabled",null),r([s({value:!0})],d.prototype,"forceUniformSize",null),r([s({constructOnly:!0})],d.prototype,"geometryType",void 0),r([s()],d.prototype,"graphic",null),r([s({constructOnly:!0})],d.prototype,"graphicProperties",void 0),r([s()],d.prototype,"graphicSymbol",null),r([s({constructOnly:!0})],d.prototype,"hasZ",void 0),r([s({constructOnly:!0})],d.prototype,"geometryToPlace",void 0),r([s()],d.prototype,"mode",null),r([s()],d.prototype,"snappingManager",void 0),r([s()],d.prototype,"snapToScene",void 0),r([s()],d.prototype,"tooltip",void 0),r([s()],d.prototype,"tooltipInfos",void 0),r([s({constructOnly:!0,type:Ut})],d.prototype,"sketchOptions",void 0),r([s()],d.prototype,"updating",null),r([s({constructOnly:!0,nonNullable:!0})],d.prototype,"view",void 0),r([s({constructOnly:!0})],d.prototype,"automaticAreaMeasurementUtils",void 0),r([s({constructOnly:!0})],d.prototype,"automaticLengthMeasurementUtils",void 0),r([s({constructOnly:!0})],d.prototype,"undoRedo",null),r([s()],d.prototype,"activeTooltipInfo",null),d=r([$("esri.views.draw.DrawGraphicTool")],d);const X=Symbol("create-operation-graphic"),v={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function $i(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const ii=48;function Ui(t,e){return Pt(t,e,!1)}function bi(t,e){return Pt(t,e,!0)}function Pt(t,e,i){if(t instanceof Ve){if(t.operation instanceof Te)return oi(t.operation,e,i),!0;if(t.operation instanceof Ie)return ni(t.operation,e,i),!0;if(t.operation instanceof Re)return ri(t.operation,e,i),!0}return!1}function oi(t,e,i=!1){const o=i?-1:1,n=ce(o*t.dx,o*t.dy,o*t.dz);tt(e.origin,e.origin,n),Q(e)}function ni(t,e,i=!1){const o=i?-t.angle:t.angle;ut(e.basis1,e.basis1,ht,o),ut(e.basis2,e.basis2,ht,o),Q(e)}function ri(t,e,i=!1){const o=i?1/t.factor1:t.factor1,n=i?1/t.factor2:t.factor2;yt(e.basis1,e.basis1,o),yt(e.basis2,e.basis2,n),gt(e.origin,e.origin,t.origin,t.axis1,o),gt(e.origin,e.origin,t.origin,t.axis2,n),Q(e)}function Vi(t,e,i,o,n=!1){o||(o=ne());const l=G(F.get(),t[1],-t[0]),a=G(F.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=G(F.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),u=F.get(),p=e.allVertices;p.forEach(({pos:f})=>{G(u,dt(t,f),dt(l,f)),re(a,a,u),se(c,c,u)});const y=1e-6,g=G(F.get(),c[0]-a[0]<y?i/2:0,c[1]-a[1]<y?i/2:0);ae(a,a,g),le(c,c,g);const w=n?p.reduce((f,h)=>f+(h.pos[2]??0),0)/p.length:0;return pt(o.basis1,t,(c[0]-a[0])/2),pt(o.basis2,l,(c[1]-a[1])/2),$t(o.origin,a[0]*t[0]+a[1]*l[0],a[0]*t[1]+a[1]*l[1],w),tt(o.origin,o.origin,o.basis1),tt(o.origin,o.origin,o.basis2),Q(o),o}export{d as E,$i as F,Vi as S,bi as T,Ui as d};
